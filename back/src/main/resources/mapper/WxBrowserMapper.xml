<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.heeexy.example.dao.WxBrowserDao">

    <!--添加某个浏览记录-->
    <insert id="addBrowsePost" parameterType="com.alibaba.fastjson.JSONObject">

        insert into  fly_browse (onuser_id, post_id) values(#{onUserId},#{postId});
    </insert>
    <!--后台显示浏览记录表-->
    <select id="getBrowseList"  parameterType="com.alibaba.fastjson.JSONObject" resultType="com.alibaba.fastjson.JSONObject">
       select  DATE_FORMAT(browse.create_time,'%Y.%m.%d %T') createTime,browse.browse_id browseId,users.user_name onUserName,
       browse.post_id postId,p.post_content postContent
        from fly_browse  browse,fly_user users,tyn_post p
        <where>
            users.user_id =browse.onuser_id and p.id =browse.post_id
            <if test="userName != null and userName != ''">
                and  users.user_name LIKE CONCAT(CONCAT('%',#{userName}),'%')
            </if>
            order by browse.create_time desc
        </where>
        LIMIT #{offSet}, #{pageRow};
    </select>
    <!--后台计算浏览记录数-->
    <select id="countBrowse" parameterType="com.alibaba.fastjson.JSONObject" resultType="java.lang.Integer">
        select count(0) from fly_browse;
    </select>
    <!--前台显示当前用户浏览记录-->
    <select id="getBrowseByUser" parameterType="com.alibaba.fastjson.JSONObject" resultType="com.alibaba.fastjson.JSONObject">
        select
            DATE_FORMAT(max(browse.create_time), '%Y.%m.%d %T')  createTime,browse.browse_id browseId,
            users.user_name onUserName,browse.post_id postId,p.post_content postContent
        from fly_browse  browse,fly_user users,tyn_post p
        where  users.user_id =browse.onuser_id and p.id =browse.post_id
          and browse.onuser_id =#{onUserId} group by post_id
    </select>
    <!--我的足迹-->
    <select id="myBrowse" parameterType="com.alibaba.fastjson.JSONObject" resultType="com.alibaba.fastjson.JSONObject">
        select b.browse_id browseId,u.user_name userName,u.user_photo userImg,b.post_id postId,p.post_content postContent
        from fly_browse b,tyn_post p,fly_user u
       where  u.user_id =p.post_owner and p.id =b.post_id
          and b.onuser_id =#{keyword} group by b.post_id
    </select>
</mapper>