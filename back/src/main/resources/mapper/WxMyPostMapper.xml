<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.heeexy.example.dao.WxMyPostDao">

    <!--后台每个用户自己的帖子记录-->
    <select id="getMyPostList" parameterType="com.alibaba.fastjson.JSONObject" resultType="com.alibaba.fastjson.JSONObject">

        select  post.id postId,post.post_content postContent,users.user_name onUserName,
                post.delete_state myPostState, DATE_FORMAT(post.post_time, '%Y.%m.%d %T')  createTime
        from  tyn_post post,fly_user users
        <where>
            post.post_owner = users.user_id
            <if test="userName != null and userName != ''">
               and  users.user_name LIKE CONCAT(CONCAT('%',#{userName}),'%')
            </if>
        </where>
        LIMIT #{offSet},#{pageRow};
    </select>
<!--后台计数-->
    <select id="countMyPost" parameterType="com.alibaba.fastjson.JSONObject" resultType="java.lang.Integer">
        select count(0) from tyn_post;
    </select>
    <!--修改自己帖子隐藏状态-->
    <update id="updateMyPostById" parameterType="com.alibaba.fastjson.JSONObject">
        <if test="myPostState == 0">
            update  tyn_post  set delete_state = 1 where id = #{postId} ;
        </if>
        <if test="myPostState == 1">
            update  tyn_post  set delete_state = 0 where id = #{postId} ;
        </if>

    </update>
    <!--前台用户自己的帖子记录-->
    <select id="getMyPostListById" parameterType="com.alibaba.fastjson.JSONObject" resultType="com.alibaba.fastjson.JSONObject">

        select  post.id postId,post.post_content postContent,users.user_name onUserName,
        post.delete_state myPostState,
        DATE_FORMAT(post.post_time, '%Y.%m.%d %T')  createTime

        from  tyn_post post,fly_user users
        where  post.post_owner =users.user_id
        and post.delete_state = 0 and post_owner = #{onUserId}
    </select>
    <!--前台本人发帖数量-->
    <select id="countMyPostByUserId" parameterType="com.alibaba.fastjson.JSONObject" resultType="com.alibaba.fastjson.JSONObject">
        select count(0) postNumber,tyn_post.post_owner userId from tyn_post
        where post_owner =#{onUserId} and delete_state =0
    </select>
    <!--批量删除帖子-->
    <update id="updateByPostIdMany" parameterType="java.util.Map">
        <if test="myPostState ==0 ">
                update  tyn_post  set delete_state = 1 where id = #{postId}
        </if>
        <if test="myPostState ==1 ">
                update  tyn_post  set delete_state = 0 where id = #{postId}
        </if>
    </update>
    <!--前台收藏帖子列表-->
    <select id="getPostCollectListByUserId" parameterType="com.alibaba.fastjson.JSONObject" resultType="com.alibaba.fastjson.JSONObject">
        select c.post_id postId, post.post_content postContent,post.post_owner userId,DATE_FORMAT(c.create_time, '%Y.%m.%d %T')  createTime
        from cqy_post_collect c,tyn_post post
        where post.id=c.post_id and c.user_id =#{onUserId} and c.display = 0
    </select>
    <!--某用户收藏帖子计数-->
    <select id="countPostCollectByUserId" parameterType="com.alibaba.fastjson.JSONObject" resultType="com.alibaba.fastjson.JSONObject">
        select count(0) collectNumber from cqy_post_collect c  where c.user_id =#{onUserId} and c.display =0
    </select>
    <!--uid:  //帖子对应用户的id
tId:’’,//帖子id,avatarUrl：”” //用户的头像（以下用户都为帖子对应用户）,username:”” //用户昵称，types:”” //帖子类型
desc:””//帖子描述，imgUrl:[ ] //帖子所对应的图片，good:[] //点赞这条信息的用户的头像, likestate:””//点赞状态
address:’’ //用户所在的地，collectionstate:boolen //收藏状态，time:’’ //用户发表的时间，seepeople:””//帖子浏览数

    commentsid：””//评论人id，commentsimg:””//评论人头像，commentsname:’’//评论昵称，commentstext:””//评论内容

-->
    <!--我已发布的帖子-->
    <select id="myPost" parameterType="com.alibaba.fastjson.JSONObject" resultType="com.alibaba.fastjson.JSONObject">

    </select>
</mapper>